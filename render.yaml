services:
  - type: web
    name: lumargo-agent
    env: docker
    plan: starter
    region: frankfurt
    autoDeploy: true

    # === DANE I DYSK ===
    disk:
      name: chroma
      mountPath: /app/data/chroma_db
      sizeGB: 1

    # === ZMIENNE ÅšRODOWISKOWE ===
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: ADMIN_TOKEN
        sync: false
      - key: EMBED_PROVIDER
        value: gemini
      - key: GEMINI_API_KEY
        sync: false

    # === PARAMETRY BUDOWANIA ===
    buildCommand: |
      echo "ðŸ”„ Czyszczenie cache i instalacja od zera"
      rm -rf /root/.cache/pip
      rm -rf /app/.venv || true
      echo "âœ… Build cache wyczyszczony"

    # === KOMENDA STARTOWA ===
    startCommand: sh -c "uvicorn app:app --host 0.0.0.0 --port ${PORT:-8000}"

    # === USTAWIENIA ZAAWANSOWANE ===
    # Wymuszenie nowego builda przy kaÅ¼dym pushu (pomaga przy problemach z cache)
    autoDeployOnCommit: true

